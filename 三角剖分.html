<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<script src="//cdn.bootcss.com/three.js/92/three.js"></script>
<script src="//unpkg.com/delaunator@2.0.0/delaunator.js"></script>
<script src="./OrbitControls.js"></script>
<script src="./earcut.js"></script>
<script src="./china.js"></script>
<script>
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
    var controls = new THREE.OrbitControls( camera );

    var renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

     // var arr = [[117.0859375,40.0751953125],[117.0224609375,40.0302734375],[116.9306640625,40.0556640625],[116.7783203125,40.033203125],[116.7578125,39.9638671875],[116.787109375,39.8876953125],[116.900390625,39.83203125],[116.9541015625,39.7880859375],[116.9169921875,39.7314453125],[116.8828125,39.71875],[116.9072265625,39.677734375],[116.8505859375,39.66796875],[116.8359375,39.6171875],[116.78515625,39.59375],[116.701171875,39.62109375],[116.56640625,39.6201171875],[116.5087890625,39.5517578125],[116.40234375,39.5283203125],[116.4345703125,39.443359375],[116.3369140625,39.45703125],[116.2587890625,39.5009765625],[116.2412109375,39.564453125],[116.185546875,39.591796875],[116.130859375,39.568359375],[115.99609375,39.5771484375],[115.978515625,39.595703125],[115.9111328125,39.6015625],[115.8876953125,39.55078125],[115.7529296875,39.5126953125],[115.66796875,39.6162109375],[115.580078125,39.58984375],[115.5458984375,39.619140625],[115.5224609375,39.640625],[115.4931640625,39.7392578125],[115.42578125,39.7744140625],[115.5693359375,39.8134765625],[115.5146484375,39.837890625],[115.521484375,39.90234375],[115.4267578125,39.951171875],[115.455078125,40.0302734375],[115.5908203125,40.0966796875],[115.599609375,40.1201171875],[115.7412109375,40.1328125],[115.77734375,40.177734375],[115.8525390625,40.1484375],[115.8984375,40.2373046875],[115.9697265625,40.2646484375],[115.9189453125,40.3544921875],[115.859375,40.36328125],[115.771484375,40.443359375],[115.75390625,40.5390625],[115.908203125,40.6181640625],[115.984375,40.5791015625],[116.1220703125,40.6298828125],[116.1650390625,40.6640625],[116.248046875,40.7919921875],[116.3095703125,40.751953125],[116.330078125,40.7744140625],[116.4619140625,40.7705078125],[116.3349609375,40.921875],[116.37109375,40.9443359375],[116.3994140625,40.90625],[116.474609375,40.896484375],[116.4560546875,40.9814453125],[116.5634765625,40.994140625],[116.6025390625,40.9765625],[116.630859375,41.0615234375],[116.6923828125,41.041015625],[116.677734375,40.9716796875],[116.7138671875,40.9111328125],[116.8046875,40.841796875],[116.876953125,40.8212890625],[116.9697265625,40.70703125],[117.2080078125,40.6953125],[117.318359375,40.658203125],[117.41015625,40.6875],[117.5009765625,40.63671875],[117.421875,40.6357421875],[117.421875,40.5703125],[117.3125,40.578125],[117.263671875,40.513671875],[117.2646484375,40.4423828125],[117.224609375,40.37109375],[117.275390625,40.3330078125],[117.33203125,40.2900390625],[117.384765625,40.1884765625],[117.3515625,40.173828125],[117.35546875,40.1396484375],[117.240234375,40.11328125],[117.2099609375,40.0830078125],[117.0859375,40.0751953125]];

     for(var a=0;a<china.features.length;a++) {
         var arr = china.features[a].geometry.coordinates
         // if (arr.length < 3) {
         //     continue
         // } else if(arr.length % 3 !== 0) {
         //     if (arr.length % 3 === 1) {
         //         arr.pop()
         //     } else {
         //         arr.pop()
         //         arr.pop()
         //     }
         // }
         var data = earcut.flatten(arr);
         var delaunay = {}
         delaunay.triangles = earcut(data.vertices, data.holes, data.dimensions);
         // const delaunay = Delaunator.from(arr);
         console.log(delaunay)
         var geometry = new THREE.Geometry();
         for(var i =0; i<arr.length - 2; i+=3) {
             geometry.vertices.push(
                 new THREE.Vector3( arr[i][0],arr[i][1],0 ),
                 new THREE.Vector3( arr[i+1][0],arr[i+1][1],0 ),
                 new THREE.Vector3( arr[i+2][0],arr[i+2][1],0 )
             );
         }
         for(var j=0;j<delaunay.triangles.length - 2;j+=3) {
             geometry.faces.push(new THREE.Face3( delaunay.triangles[j], delaunay.triangles[j+1], delaunay.triangles[j+2], new THREE.Vector3( 0, 1, 0 ), new THREE.Color( 0, 255, 0 )))
         }

         // geometry.computeFaceNormals();
         // geometry.computeVertexNormals();

         var material = new THREE.MeshBasicMaterial( {
             vertexColors: THREE.VertexColors,
             side: THREE.DoubleSide,
             wireframe: true
         } );
         var mesh = new THREE.Mesh( geometry, material ) ;

         console.log(mesh)
         scene.add(mesh)
     }

    camera.position.x = 180;
    camera.position.y = 40;
    camera.position.z = 50

    var animate = function () {
        requestAnimationFrame( animate );
        controls.update();
        renderer.render(scene, camera);
    };
    animate();
</script>
</body>
</html>